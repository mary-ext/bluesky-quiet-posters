const e=Symbol("solid-track"),t={equals:(e,t)=>e===t};let n=A;const r=1,s=2,o={owned:null,cleanups:null,context:null,owner:null};var i=null;let l=null,a=null,c=null,u=null,f=0;function h(e,t){const n=a,r=i,s=0===e.length,l=void 0===t?r:t,c=s?o:{owned:null,cleanups:null,context:l?l.context:null,owner:l},u=s?e:()=>e((()=>y((()=>U(c)))));i=c,a=null;try{return S(u,!0)}finally{a=n,i=r}}function d(e,n){const r={value:e,observers:null,observerSlots:null,comparator:(n=n?Object.assign({},t,n):t).equals||void 0};return[g.bind(r),e=>("function"==typeof e&&(e=e(r.value)),v(r,e))]}function p(e,t,n){w(m(e,t,!1,r))}function y(e){if(null===a)return e();const t=a;a=null;try{return e()}finally{a=t}}function g(){if(this.sources&&this.state)if(this.state===r)w(this);else{const e=c;c=null,S((()=>x(this)),!1),c=e}if(a){const e=this.observers?this.observers.length:0;a.sources?(a.sources.push(this),a.sourceSlots.push(e)):(a.sources=[this],a.sourceSlots=[e]),this.observers?(this.observers.push(a),this.observerSlots.push(a.sources.length-1)):(this.observers=[a],this.observerSlots=[a.sources.length-1])}return this.value}function v(e,t,n){let s=e.value;return e.comparator&&e.comparator(s,t)||(e.value=t,e.observers&&e.observers.length&&S((()=>{for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t],s=l&&l.running;s&&l.disposed.has(n),(s?n.tState:n.state)||(n.pure?c.push(n):u.push(n),n.observers&&C(n)),s||(n.state=r)}if(c.length>1e6)throw c=[],new Error}),!1)),t}function w(e){if(!e.fn)return;U(e);const t=f;!function(e,t,n){let s;const o=i,l=a;a=i=e;try{s=e.fn(t)}catch(c){return e.pure&&(e.state=r,e.owned&&e.owned.forEach(U),e.owned=null),e.updatedAt=n+1,T(c)}finally{a=l,i=o}(!e.updatedAt||e.updatedAt<=n)&&(null!=e.updatedAt&&"observers"in e?v(e,s):e.value=s,e.updatedAt=n)}(e,e.value,t)}function m(e,t,n,s=r,l){const a={fn:e,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:i,context:i?i.context:null,pure:n};return null===i||i!==o&&(i.owned?i.owned.push(a):i.owned=[a]),a}function b(e){if(0===e.state)return;if(e.state===s)return x(e);if(e.suspense&&y(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<f);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if((e=t[n]).state===r)w(e);else if(e.state===s){const n=c;c=null,S((()=>x(e,t[0])),!1),c=n}}function S(e,t){if(c)return e();let r=!1;t||(c=[]),u?r=!0:u=[],f++;try{const t=e();return function(e){if(c&&(A(c),c=null),e)return;const t=u;u=null,t.length&&S((()=>n(t)),!1)}(r),t}catch(s){r||(u=null),c=null,T(s)}}function A(e){for(let t=0;t<e.length;t++)b(e[t])}function x(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const o=e.sources[n];if(o.sources){const e=o.state;e===r?o!==t&&(!o.updatedAt||o.updatedAt<f)&&b(o):e===s&&x(o,t)}}}function C(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=s,n.pure?c.push(n):u.push(n),n.observers&&C(n))}}function U(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),n=e.sourceSlots.pop(),r=t.observers;if(r&&r.length){const e=r.pop(),s=t.observerSlots.pop();n<r.length&&(e.sourceSlots[s]=n,r[n]=e,t.observerSlots[n]=s)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)U(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function T(e,t=i){const n=function(e){return e instanceof Error?e:new Error("string"==typeof e?e:"Unknown error",{cause:e})}(e);throw n}const k=Symbol("fallback");function E(e){for(let t=0;t<e.length;t++)e[t]()}function N(e,t){return y((()=>e(t||{})))}function D(n){const r="fallback"in n&&{fallback:()=>n.fallback};return function(e,n,r){r=r?Object.assign({},t,r):t;const s=m(e,void 0,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=r.equals||void 0,w(s),g.bind(s)}(function(t,n,r={}){let s=[],o=[],l=[],a=0,c=n.length>1?[]:null;var u;return u=()=>E(l),null===i||(null===i.cleanups?i.cleanups=[u]:i.cleanups.push(u)),()=>{let i,u,f=t()||[];return f[e],y((()=>{let e,t,n,d,y,g,v,w,m,b=f.length;if(0===b)0!==a&&(E(l),l=[],s=[],o=[],a=0,c&&(c=[])),r.fallback&&(s=[k],o[0]=h((e=>(l[0]=e,r.fallback()))),a=1);else if(0===a){for(o=new Array(b),u=0;u<b;u++)s[u]=f[u],o[u]=h(p);a=b}else{for(n=new Array(b),d=new Array(b),c&&(y=new Array(b)),g=0,v=Math.min(a,b);g<v&&s[g]===f[g];g++);for(v=a-1,w=b-1;v>=g&&w>=g&&s[v]===f[w];v--,w--)n[w]=o[v],d[w]=l[v],c&&(y[w]=c[v]);for(e=new Map,t=new Array(w+1),u=w;u>=g;u--)m=f[u],i=e.get(m),t[u]=void 0===i?-1:i,e.set(m,u);for(i=g;i<=v;i++)m=s[i],u=e.get(m),void 0!==u&&-1!==u?(n[u]=o[i],d[u]=l[i],c&&(y[u]=c[i]),u=t[u],e.set(m,u)):l[i]();for(u=g;u<b;u++)u in n?(o[u]=n[u],l[u]=d[u],c&&(c[u]=y[u],c[u](u))):o[u]=h(p);o=o.slice(0,a=b),s=f.slice(0)}return o}));function p(e){if(l[u]=e,c){const[e,t]=d(u);return c[u]=t,n(f[u],e)}return n(f[u])}}}((()=>n.each),n.children,r||void 0))}function I(e,t,n){let r;const s=()=>{const t=document.createElement("template");return t.innerHTML=e,n?t.content.firstChild.firstChild:t.content.firstChild},o=t?()=>y((()=>document.importNode(r||(r=s()),!0))):()=>(r||(r=s())).cloneNode(!0);return o.cloneNode=o,o}function R(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function F(e,t,n,r){if(void 0===n||r||(r=[]),"function"!=typeof t)return M(e,t,r,n);p((r=>M(e,t(),r,n)),r)}function M(e,t,n,r,s){for(;"function"==typeof n;)n=n();if(t===n)return n;const o=typeof t,i=void 0!==r;if(e=i&&n[0]&&n[0].parentNode||e,"string"===o||"number"===o)if("number"===o&&(t=t.toString()),i){let s=n[0];s&&3===s.nodeType?s.data=t:s=document.createTextNode(t),n=L(e,n,r,s)}else n=""!==n&&"string"==typeof n?e.firstChild.data=t:e.textContent=t;else if(null==t||"boolean"===o)n=L(e,n,r);else{if("function"===o)return p((()=>{let s=t();for(;"function"==typeof s;)s=s();n=M(e,s,n,r)})),()=>n;if(Array.isArray(t)){const o=[],l=n&&Array.isArray(n);if(B(o,t,n,s))return p((()=>n=M(e,o,n,r,!0))),()=>n;if(0===o.length){if(n=L(e,n,r),i)return n}else l?0===n.length?P(e,o,r):function(e,t,n){let r=n.length,s=t.length,o=r,i=0,l=0,a=t[s-1].nextSibling,c=null;for(;i<s||l<o;)if(t[i]!==n[l]){for(;t[s-1]===n[o-1];)s--,o--;if(s===i){const t=o<r?l?n[l-1].nextSibling:n[o-l]:a;for(;l<o;)e.insertBefore(n[l++],t)}else if(o===l)for(;i<s;)c&&c.has(t[i])||t[i].remove(),i++;else if(t[i]===n[o-1]&&n[l]===t[s-1]){const r=t[--s].nextSibling;e.insertBefore(n[l++],t[i++].nextSibling),e.insertBefore(n[--o],r),t[s]=n[o]}else{if(!c){c=new Map;let e=l;for(;e<o;)c.set(n[e],e++)}const r=c.get(t[i]);if(null!=r)if(l<r&&r<o){let a,u=i,f=1;for(;++u<s&&u<o&&null!=(a=c.get(t[u]))&&a===r+f;)f++;if(f>r-l){const s=t[i];for(;l<r;)e.insertBefore(n[l++],s)}else e.replaceChild(n[l++],t[i++])}else i++;else t[i++].remove()}}else i++,l++}(e,n,o):(n&&L(e),P(e,o));n=o}else if(t.nodeType){if(Array.isArray(n)){if(i)return n=L(e,n,r,t);L(e,n,null,t)}else null!=n&&""!==n&&e.firstChild?e.replaceChild(t,e.firstChild):e.appendChild(t);n=t}}return n}function B(e,t,n,r){let s=!1;for(let o=0,i=t.length;o<i;o++){let i,l=t[o],a=n&&n[o];if(null==l||!0===l||!1===l);else if("object"==(i=typeof l)&&l.nodeType)e.push(l);else if(Array.isArray(l))s=B(e,l,a)||s;else if("function"===i)if(r){for(;"function"==typeof l;)l=l();s=B(e,Array.isArray(l)?l:[l],Array.isArray(a)?a:[a])||s}else e.push(l),s=!0;else{const t=String(l);a&&3===a.nodeType&&a.data===t?e.push(a):e.push(document.createTextNode(t))}}return s}function P(e,t,n=null){for(let r=0,s=t.length;r<s;r++)e.insertBefore(t[r],n)}function L(e,t,n,r){if(void 0===n)return e.textContent="";const s=r||document.createTextNode("");if(t.length){let r=!1;for(let o=t.length-1;o>=0;o--){const i=t[o];if(s!==i){const t=i.parentNode===e;r||o?t&&i.remove():t?e.replaceChild(s,i):e.insertBefore(s,n)}else r=!0}}else e.insertBefore(s,n);return[s]}class J{#e;on(e,t){let n,r;n=this.#e,void 0===n?n=this.#e=Object.create(null):r=n[e],void 0===r?n[e]=t:"function"==typeof r?n[e]=[r,t]:r.push(t)}off(e,t){const n=this.#e;if(void 0===n)return;const r=n[e];if(null!=r)if(r===t)delete n[e];else if("function"!=typeof r){const s=r.indexOf(t);-1!==s&&(2===r.length?n[e]=r[0===s?1:0]:r.splice(s,1))}}emit(e,...t){const n=this.#e;if(void 0===n)return;const r=n[e];if(void 0!==r)if("function"==typeof r)r.apply(this,t);else{const e=r.slice();for(let n=0,r=e.length;n<r;n++)e[n].apply(this,t)}}}const O=e=>{const t=e.split(".")[1];let n;if("string"!=typeof t)throw new Error("invalid token: missing part 2");try{n=(e=>{var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return(e=>decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))))(t)}catch(n){return atob(t)}})(t)}catch(r){throw new Error("invalid token: invalid b64 for part 2 ("+r.message+")")}try{return JSON.parse(n)}catch(r){throw new Error("invalid token: invalid json for part 2 ("+r.message+")")}},$=new TextEncoder,j=new TextDecoder;class q{constructor(e,t){this.data=e,this.headers=t}success=!0}class z extends Error{constructor(e,t,n){super(n||t),this.status=e,this.error=t,this.name="XRPCError"}success=!1}var _=(e=>(e[e.Unknown=1]="Unknown",e[e.InvalidResponse=2]="InvalidResponse",e[e.Success=200]="Success",e[e.InvalidRequest=400]="InvalidRequest",e[e.AuthRequired=401]="AuthRequired",e[e.Forbidden=403]="Forbidden",e[e.XRPCNotSupported=404]="XRPCNotSupported",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.RateLimitExceeded=429]="RateLimitExceeded",e[e.InternalServerError=500]="InternalServerError",e[e.MethodNotImplemented=501]="MethodNotImplemented",e[e.UpstreamFailure=502]="UpstreamFailure",e[e.NotEnoughResouces=503]="NotEnoughResouces",e[e.UpstreamTimeout=504]="UpstreamTimeout",e))(_||{});const Z=e=>e in _?e:e>=100&&e<200?404:e>=200&&e<300?200:e>=300&&e<400?404:e>=400&&e<500?400:500,H=(e,t)=>{if(e["Content-Type"]&&void 0!==t)return t instanceof ArrayBuffer||t instanceof Blob?t:e["Content-Type"].startsWith("text/")?$.encode(t.toString()):e["Content-Type"].startsWith("application/json")?$.encode(JSON.stringify(t)):t},Y=(e,t)=>{if(e){if(e.includes("application/json")&&t?.byteLength)try{const e=j.decode(t);return JSON.parse(e)}catch(n){throw new z(2,`Failed to parse response body: ${String(n)}`)}if(e.startsWith("text/")&&t?.byteLength)try{return j.decode(t)}catch(n){throw new z(2,`Failed to parse response body: ${String(n)}`)}}return t instanceof ArrayBuffer?new Uint8Array(t):t},W=(e,t)=>{if(!e)return!1;const n=typeof e.error,r=typeof e.message;return("undefined"===n||"string"===n)&&("undefined"===r||"string"===r)&&(!t||t.includes(e.error))},X=async(e,t,n,r,s)=>{try{const o={signal:s,method:t,headers:n,body:H(n,r),duplex:"half"},i=await fetch(e,o),l=await i.arrayBuffer();return{status:i.status,headers:Object.fromEntries(i.headers.entries()),body:Y(i.headers.get("content-type"),l)}}catch(o){throw new z(_.Unknown,String(o))}};class K{constructor(e,t=X){this.serviceUri=e,this.fetch=t}get(e,t){return this.#t({type:"get",method:e,...t})}call(e,t){return this.#t({type:"post",method:e,...t})}async#t(e){const{type:t,method:n,params:r,data:s,encoding:o,headers:i={},signal:l}=e,a=((e,t,n)=>{const r=new URL(`/xrpc/${e}`,t);if(n)for(const s in n){const e=n[s];if(void 0!==e)if(Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];r.searchParams.append(s,n)}else r.searchParams.set(s,e)}return r.toString()})(n,this.serviceUri,r),c=((e,t,n,r)=>("post"===t&&(n&&"object"==typeof n&&(e["Content-Type"]||(e["Content-Type"]="application/json")),r&&(e["Content-Type"]=r)),e))(i,t,s,o),u=await this.fetch(a,t,c,s,l),f=Z(u.status);if(f===_.Success)return new q(u.body,u.headers);throw u.body&&W(u.body)?new z(f,u.body.error,u.body.message):new z(f)}}const V=(e,t,n)=>{const r=e.id+t,s=e.service?.find((e=>e.id===t||e.id===r));if(s&&s.type===n&&"string"==typeof s.serviceEndpoint)return G(s.serviceEndpoint)},G=e=>{let t;try{t=new URL(e)}catch{return}const n=t.protocol;if(t.hostname&&("http:"===n||"https:"===n))return e},Q=36e5,ee=24*Q,te=7*ee,ne=4*te,re=12*ne,se=new Intl.DateTimeFormat("en-US",{dateStyle:"medium"}),oe=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}),ie=new Intl.DateTimeFormat("en-US",{dateStyle:"long",timeStyle:"short"}),le={},ae=I('<div><h3>Bluesky quiet posters</h3><p>List of your follows sorted by least active</p><form class=input-form><input type=text name=handle required placeholder=example.bsky.social pattern=@?([a-zA-Z0-9\\-]+(?:\\.[a-zA-Z0-9\\-]+)*(?:\\.[a-zA-Z]+))|did:[a-z]+:[a-zA-Z0-9._\\-]+ title="Bluesky handle or DID"><button type=submit>Go!</button></form><hr><div class=message-info></div><div class=profile-list>'),ce=I("<a target=_blank class=profile><img class=profile-avatar><div class=profile-info><p class=profile-name></p><div class=profile-subinfo><span class=profile-handle>@</span><span class=dot>·"),ue=I("<span class=profile-activity>"),fe=I('<span class="profile-activity is-empty">no activity'),he=new class extends J{rpc;fetch;serviceUri;session;#n;constructor(e){super(),this.fetch=e.fetch??X,this.serviceUri=e.serviceUri,this.rpc=new K(this.serviceUri),this.rpc.fetch=this.#r.bind(this)}async login(e){this.#s();const t=await this.rpc.call("com.atproto.server.createSession",{data:{identifier:e.identifier,password:e.password}});return this.#o(t.data)}async resumeSession(e){const t=Date.now()/1e3+300;if(t>=O(e.refreshJwt).exp)throw new Error("INVALID_TOKEN");const n=O(e.accessJwt);if(this.#s(e),t>=n.exp&&await this.#i(),!this.session)throw new Error("INVALID_TOKEN");return this.session}async#r(e,t,n,r,s){await this.#n;let o=await this.fetch(e,t,this.#l(n),r,s);return W(o.body,["ExpiredToken"])&&this.session?.refreshJwt&&(await this.#i(),this.session&&(o=await this.fetch(e,t,this.#l(n),r,s))),o}#l(e){const t=this.session;return!e.authorization&&t?{...e,authorization:`Bearer ${t.accessJwt}`}:e}async#i(){if(this.#n)return this.#n;this.#n=this.#a();try{await this.#n}finally{this.#n=void 0}}async#a(){const e=this.session;if(!e||!e.refreshJwt)return;const t=new URL("/xrpc/com.atproto.server.refreshSession",e.pdsUri||this.serviceUri),n=await this.fetch(t.toString(),"POST",{authorization:`Bearer ${e.refreshJwt}`},void 0,void 0);W(n.body,["ExpiredToken","InvalidToken"])?(this.#s(),this.emit("sessionExpired")):Z(n.status)===_.Success&&(this.#o(n.body),this.emit("sessionUpdate",this.session))}#s(e){this.session=e,this.rpc.serviceUri=e&&e.pdsUri||this.serviceUri}#o(e){const t=e.didDoc;let n;return t&&(n=V(t,"#atproto_pds","AtprotoPersonalDataServer")),this.rpc.serviceUri=n||this.serviceUri,this.session={accessJwt:e.accessJwt,refreshJwt:e.refreshJwt,handle:e.handle,did:e.did,pdsUri:n,email:e.email,emailConfirmed:e.emailConfirmed}}}({serviceUri:"https://api.bsky.app"}),de=[],pe=(e,t)=>(e.lastActivity??-1)-(t.lastActivity??-1),ye=()=>{let e;const[t,n]=d(),[r,s]=d(de),o=t=>{const r=new FormData(t.currentTarget);t.preventDefault();const o=r.get("handle").replace(/^@/,"");e?.abort(),e=new AbortController;const i=e.signal;s(de),(async(e,t)=>{let r,o=[];do{n(`Retrieving your follows (${o.length} users)`);const s=(await he.rpc.get("app.bsky.graph.getFollows",{signal:t,params:{actor:e,cursor:r}})).data;o=o.concat(s.follows),r=s.cursor}while(void 0!==r);let i=[];for(let l=0,a=o.length;l<a;l++){const e=o[l];n(`Retrieving @${e.handle} (${l+1}/${a})`);const r=(await he.rpc.get("app.bsky.feed.getAuthorFeed",{signal:t,params:{actor:e.did,limit:21}})).data.feed,c=new Date;let u,f=0;for(let t=0,n=r.length;t<n;t++){const{post:e,reason:n}=r[t],s=new Date(n?n.indexedAt:e.indexedAt);c.getDate()===s.getDate()&&c.getMonth()===s.getMonth()&&c.getFullYear()===s.getFullYear()&&f++,u??=s.getTime()}i=i.concat({profile:e,activityCount:f,lastActivity:u}),i.sort(pe),s(i)}n("Done.")})(o,i).catch((e=>{i.aborted||n(`Oops, an error occured. ${e}`)}))};return(()=>{const e=ae(),n=e.firstChild.nextSibling.nextSibling,s=n.nextSibling.nextSibling,i=s.nextSibling;return n.addEventListener("submit",o),F(s,t),F(i,N(D,{get each(){return r()},children:({profile:e,lastActivity:t})=>{const n=`https://bsky.app/profile/${e.did}`;return(()=>{const r=ce(),s=r.firstChild,o=s.nextSibling.firstChild,i=o.nextSibling,l=i.firstChild;return l.firstChild,l.nextSibling,R(r,"href",n),R(s,"src",e.avatar||"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='80'%20height='80'%20fill='none'%20viewBox='0%200%2024%2024'%3e%3ccircle%20cx='12'%20cy='12'%20r='12'%20fill='%230070ff'/%3e%3ccircle%20cx='12'%20cy='9.5'%20r='3.5'%20fill='%23fff'/%3e%3cpath%20fill='%23fff'%20d='M12.058%2022.784c-2.636%200-5.051-.948-6.921-2.522.53-2.274%203.397-4.012%206.853-4.012%203.504%200%206.401%201.786%206.874%204.107-1.854%201.517-4.224%202.427-6.806%202.427Z'/%3e%3c/svg%3e"),F(o,e.displayName||`@${e.handle}`),F(l,e.handle,null),F(i,void 0!==t?(()=>{const e=ue();return R(e,"title",(e=>{const t=new Date(e);return ie.format(t)})(t)),F(e,((e,t=new Date)=>{const n=new Date(e),r=n.getTime(),s=Math.abs(r-t.getTime());if(s>te)return n.getFullYear()===t.getFullYear()?oe.format(n):se.format(n);const[o,i]=(e=>e<1e3?[0,"second"]:e<6e4?[Math.trunc(e/1e3),"second"]:e<Q?[Math.trunc(e/6e4),"minute"]:e<ee?[Math.trunc(e/Q),"hour"]:e<te?[Math.trunc(e/ee),"day"]:e<ne?[Math.trunc(e/te),"week"]:e<re?[Math.trunc(e/ne),"month"]:[Math.trunc(e/re),"year"])(s);return(le[i]||=new Intl.NumberFormat("en-US",{style:"unit",unit:i,unitDisplay:"narrow"})).format(Math.abs(o))})(t)),e})():fe(),null),r})()}})),e})()};!function(e,t,n,r={}){let s;h((r=>{s=r,t===document?e():F(t,e(),t.firstChild?null:void 0,n)}),r.owner)}((()=>N(ye,{})),document.getElementById("root"));
//# sourceMappingURL=index-m3iiRg49.js.map
